# AutoTally AI - Project Documentation

## 1. Project Overview
**AutoTally AI** is a desktop application designed to automate accounting workflows for Tally Prime. It leverages Artificial Intelligence (Gemini AI) to extract data from invoices and bank statements, allowing users to seamlessly push processed data into Tally Prime via XML integration.

### Core Capabilities
- **AI-Powered OCR**: Automatically extracts details (Date, Invoice No, Parties, Amounts, GST) from PDF/Image invoices.
- **Bank Statement Processing**: Parses PDF/Excel bank statements and auto-categorizes transactions into Tally ledgers.
- **Excel Import**: Flexible mapper to import custom Excel data (Sales/Purchase/Journal).
- **Tally Integration**: Direct synchronization with Tally Prime locally using Tally's XML Interface.

---

## 2. Technical Architecture

### 2.1 Technology Stack
- **Frontend Framework**: [React](https://react.dev/) (v19) with [TypeScript](https://www.typescriptlang.org/).
- **Desktop Container**: [Electron](https://www.electronjs.org/) (via `electron-builder`).
- **Build Tool**: [Vite](https://vitejs.dev/).
- **Styling**: [Tailwind CSS](https://tailwindcss.com/) (v3.4).
- **Backend/AI Service**: Python (FastAPI/Flask) handling AI processing (Gemini API) and PDF parsing.
- **Database**: Local JSON/SQLite storage for persistence (via `dbService.ts`).

### 2.2 System Diagram
```mermaid
graph TD
    User[User] -->|Interacts| GUI[Electron + React UI]
    GUI -->|Files & Requests| Backend[Python Backend Service]
    Backend -->|Images/PDFs| AI[Google Gemini AI]
    AI -->|Structured JSON| Backend
    Backend -->|JSON Data| GUI
    GUI -->|XML Request| Tally[Tally Prime]
    GUI -->|Store/Retrieve| DB[Local DB / File System]
```

---

## 3. Key Modules & Features

### 3.1 Dashboard (`Dashboard.tsx`)
- Central hub displaying recent files (Invoices, Bank Statements, Imports).
- Status tracking (Processing, Ready, Failed, Success).
- **Single Push**: Push individual "Ready" documents to Tally.
- **Bulk Actions**: Search, filter, and export data.

### 3.2 Invoice Automation (`InvoiceEditor.tsx`)
- **Upload**: Drag-and-drop support for PDFs and Images.
- **AI Extraction**: Uses backend AI to predict Ledger mapping (Sales/Purchase) and extract line items.
- **Editor**: Manual override for extracted data before pushing.
- **Validation**: Checks for Company Name mismatch (Buyer vs Supplier) and Duplicate Invoice Numbers.
- **Tally Sync**: Generates Vouchers (Sales/Purchase) and creates missing Ledgers automatically if configured.

### 3.3 Bank Statement Manager (`BankStatementManager.tsx`)
- **PDF/Excel Parsing**: Handles complex bank statement formats.
- **Auto-Categorization**: Heuristic and AI-based guessing of Ledgers based on transaction descriptions (e.g., "UPI/ZEPTO" -> "Zepto Expenses").
- **UI**: Interactive transaction list with Credit (Green)/Debit (Red) highlighting.

### 3.4 Excel Import (`ExcelImportManager.tsx`)
- **Dynamic Mapping**: Map Excel columns to Tally fields (Date, Ref No, Party, Amount, Tax).
- **Validation**: Strict checks for missing required fields.

---

## 4. Development & Build Setup

### 4.1 Prerequisites
- **Node.js**: v18+
- **Python**: v3.10+ (for Backend)
- **Tally Prime**: Running locally (Default Port: 9000).

### 4.2 Application Commands
Scripts are defined in `package.json`:

| Command | Description |
| :--- | :--- |
| `npm run dev` | Starts the React Dev Server (Browser Mode). |
| `npm run electron:dev` | Runs current code in Electron window. |
| `npm run build` | Compiles React app to `dist/`. |
| `npm run electron:build` | Packages the application into an `.exe`. |

### 4.3 Build Configuration
The electron builder config is located in `package.json` under `"build"` field:
- **Output Directory**: `release_v22` (Current Version).
- **App ID**: `com.autotally.ai`.
- **Target**: NSIS Installer (Windows).

---

## 5. Directory Structure
```
DesktopApp/
├── electron/           # Electron Main Process code (main.js, preload.js)
├── src/
│   ├── components/     # React Components (Dashboard, Editors, Modals)
│   ├── services/       # API Services (tallyService, backendService, dbService)
│   ├── types/          # TypeScript Interfaces
│   ├── App.tsx         # Main Layout & Routing
│   └── index.css       # Tailwind & Global Styles
├── backend/            # Python AI Service Code
├── package.json        # Dependencies & Scripts
└── tailwind.config.js  # Style Configuration
```

---

## 6. Recent Updates (v0.2.3)
